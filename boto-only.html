<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MinerBits — Boto</title>

  <style>
    :root{
      --tile: 64px;                 /* tamanho de cada frame (64x64) */
      --frames: 4;                  /* frames do estado ativo (o JS atualiza) */
      --fps: 12;                    /* taxa base (o JS ajusta por estado) */
      --row: 0;                     /* linha atual no spritesheet */
      --sheet: url('sprites/boto.png'); /* ← spritesheet (1 linha por estado) */
    }

    /* Palquinho simples só pra ver bonito (opcional) */
    html,body{height:100%}
    body{
      margin:0; display:grid; place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 30% -10%, #192a56 0%, #0b1220 60%);
      color:#e6eef8;
    }

    /* O sprite em si */
    .pet{
      width: var(--tile);
      height: var(--tile);
      image-rendering: pixelated;      /* mantém o pixel art nítido */
      background-image: var(--sheet);
      background-repeat: no-repeat;
      background-size: auto var(--tile);   /* altura da imagem = 1 tile */
      background-position: 0 calc(var(--row) * (var(--tile) * -1));
      filter: drop-shadow(0 2px 0 #0008) drop-shadow(0 6px 16px #0007);
    }

    /* Animação com steps (var(--frames)) movendo o background no eixo X */
    @keyframes run {
      from { background-position-x: 0; }
      to   { background-position-x: calc((var(--frames) - 1) * var(--tile) * -1); }
    }
    .run{
      animation-name: run;
      animation-timing-function: steps(var(--frames));
      animation-fill-mode: forwards;
    }
    @media (prefers-reduced-motion: reduce){ .run{ animation: none !important; } }

    /* Controles de teste (pode remover no app final) */
    .panel{margin-top:16px;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
    .panel button{
      background:#16233f;border:1px solid #263556;color:#e6eef8;
      padding:8px 12px;border-radius:12px;cursor:pointer
    }
    .panel button:hover{background:#1b2a4e}
    .wrap{display:grid;place-items:center;gap:10px}
  </style>
</head>
<body>
  <div class="wrap">
  <!-- O BOTO - agora como web component -->
  <boto-component id="pet" size="128" tile="64" sheet="minerbits-boto-minimal/boto.png" role="img" aria-label="Boto cor-de-rosa"></boto-component>

    <!-- Botões de teste (opcional) -->
    <div class="panel">
      <button data-action="tap">Tap</button>
      <button data-action="wave">Wave</button>
      <button data-action="success">Success</button>
      <button data-action="error">Error</button>
      <button data-action="loading">Loading</button>
      <button data-action="idle">Idle</button>
    </div>
  </div>

  <script type="module">
    import './minerbits-boto-minimal/src/boto-component.js';

    const pet = document.getElementById('pet');

    // Hook buttons to the component API
    document.querySelectorAll('[data-action]').forEach(b => {
      b.addEventListener('click', async () => {
        const state = b.dataset.action;
        // play returns a promise for non-loop states
        try{ await pet.play(state); }catch(e){ /* ignore */ }
      });
    });

    window.addEventListener('keydown', e => {
      const i = +e.key - 1, K = ['idle','tap','wave','success','error','loading'];
      if (i >= 0 && i < K.length) pet.play(K[i]);
    });

    // optional: listen for when a non-loop finishes
    pet.addEventListener('ended', (ev) => {
      console.log('animation ended', ev.detail);
    });

    // start idle
    pet.play('idle');
  </script>
</body>
</html>
